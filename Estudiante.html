<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  
  <?!= include('Stylesheet'); ?>
</head>
<body>

  <!-- Header Superior -->
  <div class="header-container">
    <div class="top-bar">Sistema de Reportes Académicos • Plataforma de Notas en Tiempo Real</div>
    <div class="main-header">
      <div class="header-left">
        <div class="system-title">Sistema de Reportes Académicos</div>
        <div class="system-name">Portal del Estudiante CITEN</div>
      </div>
      <div class="header-right">
        <div class="header-welcome">
          <div class="welcome-label">Bienvenido(a)</div>
          <div class="user-name">
            <span id="student-name"><?= usuario.nombres ?> <?= usuario.apellidos ?></span>
            <i class="fas fa-user-graduate"></i>
          </div>
        </div>
        <div class="logo-container">
          <img src="https://citen.edu.pe/wp-content/uploads/2023/05/ESCUDO-CITEN-1.png" alt="Logo CITEN" class="header-logo">
        </div>
      </div>
    </div>
  </div>

  <!-- Contenedor Principal -->
  <div class="app-container">
    
    <!-- Sidebar de Navegación -->
    <nav class="sidebar">
      <div class="student-profile">
        <div class="profile-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="profile-info">
          <h4><?= usuario.nombres ?></h4>
          <p><?= usuario.grado ?> - Sección <?= usuario.seccion ?></p>
        </div>
      </div>
      
      <!-- MENÚ DE NAVEGACIÓN CORREGIDO (UNA SOLA LISTA) -->
      <ul class="sidebar-nav">
        <li><a href="#" class="nav-link active" data-target="resumen"><i class="fas fa-chart-line"></i> Resumen General</a></li>
        <li><a href="#" class="nav-link" data-target="areas"><i class="fas fa-book-open"></i> Por Área Curricular</a></li>
        <li><a href="#" class="nav-link" data-target="competencias"><i class="fas fa-tasks"></i> Por Competencias</a></li>
        <li><a href="#" class="nav-link" data-target="historico"><i class="fas fa-history"></i> Histórico</a></li>
        <li><a href="#" class="nav-link" data-target="calificaciones"><i class="fas fa-list-alt"></i> Todas las Notas</a></li>
        <li><a href="#" class="nav-link" data-target="reporte-notas"><i class="fas fa-file-invoice"></i> Reporte de Notas</a></li>
      </ul>

      <div class="sidebar-footer">
        <div class="promedio-general">
          <div class="promedio-label">Promedio General</div>
          <div class="promedio-value" id="promedio-sidebar">--</div>
          <div class="promedio-nivel" id="nivel-sidebar">Cargando...</div>
        </div>
      </div>
    </nav>

    <!-- Área de Contenido -->
    <main class="content-area">
      
      <!-- Loader -->
      <div id="global-loader" class="loader-overlay">
        <div class="loader-content">
          <div class="spinner-border text-warning" role="status"></div>
          <p class="mt-3">Cargando datos académicos...</p>
        </div>
      </div>

      <!-- Sección: Resumen General -->
      <section id="resumen" class="content-section active">
        <div class="page-header">
          <h2><i class="fas fa-chart-line"></i> Resumen General de Rendimiento</h2>
        </div>
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="stat-card stat-card-blue">
              <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
              <div class="stat-content">
                <h3 id="promedio-general">--</h3>
                <p>Promedio General</p>
                <div class="stat-badge" id="nivel-general">--</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card stat-card-green">
              <div class="stat-icon"><i class="fas fa-star"></i></div>
              <div class="stat-content">
                <h3 id="total-ad">0</h3>
                <p>Logros Destacados (AD)</p>
                <div class="stat-badge badge-ad">Excelente</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card stat-card-yellow">
              <div class="stat-icon"><i class="fas fa-tasks"></i></div>
              <div class="stat-content">
                <h3 id="total-evaluaciones">0</h3>
                <p>Total de Evaluaciones</p>
                <div class="stat-badge badge-info">Registradas</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card stat-card-red">
              <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
              <div class="stat-content">
                <h3 id="areas-riesgo">0</h3>
                <p>Áreas a Reforzar</p>
                <div class="stat-badge badge-warning">Atención</div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-8">
            <div class="card">
              <div class="card-body">
                <h5><i class="fas fa-chart-bar"></i> Rendimiento por Área Curricular</h5>
                <div id="chart-areas" style="width: 100%; height: 400px;"></div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-body">
                <h5><i class="fas fa-chart-pie"></i> Distribución de Niveles</h5>
                <div id="chart-distribucion" style="width: 100%; height: 400px;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h5><i class="fas fa-clock"></i> Últimas Calificaciones Registradas</h5>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Fecha</th><th>Área</th><th>Competencia</th><th>Calificación</th><th>Nivel</th><th>Retroalimentación</th>
                      </tr>
                    </thead>
                    <tbody id="ultimas-notas">
                      <tr><td colspan="6" class="text-center text-muted">Cargando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sección: Por Área Curricular -->
      <section id="areas" class="content-section">
        <div class="page-header">
          <h2><i class="fas fa-book-open"></i> Rendimiento por Área Curricular</h2>
        </div>
        <div id="areas-container" class="row"></div>
      </section>

      <!-- Sección: Por Competencias -->
      <section id="competencias" class="content-section">
        <div class="page-header">
          <h2><i class="fas fa-tasks"></i> Detalle por Competencias</h2>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <label>Filtrar por Área:</label>
            <select id="filtro-area-comp" class="form-control"><option value="">Todas las áreas</option></select>
          </div>
        </div>
        <div id="competencias-container"></div>
      </section>

      <!-- Sección: Histórico -->
      <section id="historico" class="content-section">
        <div class="page-header">
          <h2><i class="fas fa-history"></i> Histórico de Progreso</h2>
        </div>
        <div class="card">
          <div class="card-body">
            <h5><i class="fas fa-chart-line"></i> Evolución del Rendimiento</h5>
            <div id="chart-evolucion" style="width: 100%; height: 400px;"></div>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h5><i class="fas fa-calendar-alt"></i> Comparativa por Periodo</h5>
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Periodo</th><th>Promedio</th><th>Nivel</th><th>Total Notas</th><th>Tendencia</th>
                      </tr>
                    </thead>
                    <tbody id="tabla-periodos">
                      <tr><td colspan="5" class="text-center text-muted">Cargando...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sección: Todas las Calificaciones -->
      <section id="calificaciones" class="content-section">
        <div class="page-header">
          <h2><i class="fas fa-list-alt"></i> Registro Completo de Calificaciones</h2>
        </div>
        <div class="row mb-3">
          <div class="col-md-4">
            <label>Filtrar por Área:</label>
            <select id="filtro-area" class="form-control"><option value="">Todas las áreas</option></select>
          </div>
          <div class="col-md-4">
            <label>Filtrar por Periodo:</label>
            <select id="filtro-periodo" class="form-control"><option value="">Todos los periodos</option></select>
          </div>
          <div class="col-md-4">
            <label>&nbsp;</label>
            <button class="btn btn-primary btn-block" onclick="aplicarFiltros()"><i class="fas fa-filter"></i> Aplicar Filtros</button>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Fecha</th><th>Área</th><th>Competencia</th><th>Calificación</th><th>Nota</th><th>Periodo</th><th>Retroalimentación</th>
                  </tr>
                </thead>
                <tbody id="tabla-calificaciones">
                  <tr><td colspan="7" class="text-center text-muted">Cargando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- SECCIÓN REPORTE DE NOTAS (UBICACIÓN CORRECTA) -->
      <section id="reporte-notas" class="content-section">
        <div class="page-header">
          <h2><i class="fas fa-file-invoice"></i> Reporte Detallado de Notas</h2>
        </div>
        <div class="card">
          <div class="card-body" id="reporte-container">
            <p class="text-center text-muted">Cargando reporte...</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Scripts (UBICACIÓN Y ORDEN CORRECTOS) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script>
    const initialData = <?!= initialData ?>;
  </script>
  <?!= include('JavaScript'); ?>

</body>
</html>

